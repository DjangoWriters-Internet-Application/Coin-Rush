{% extends "Base/base.html" %}
{% load static %}
{% block extraHead %}
<link rel="stylesheet" href="{% static 'css/news.css' %}">
{% endblock extraHead %}

{% block content %}
<!-- Display success messages -->
{% if messages %}
{% for message in messages %}
<div class="alert alert-success">
    {{ message }}
</div>
{% endfor %}
{% endif %}
<div class="container">
    {% if user.is_superuser %}
    <button class="btn btn-primary" onclick="openForm()">Create News</button>
    <div id="newsFormContainer" class="form-container">
        <form id="newsForm" method="post" action="{% url 'news' %}" enctype="multipart/form-data">
            {% csrf_token %}

            {% for field in newsForm %}
            <div class="form-group">
                {{ field.label_tag }}
                {{ field }}
                {% if field.help_text %}
                <small>{{ field.help_text }}</small>
                {% endif %}
            </div>
            {% endfor %}
            <button type="submit" class="submit-button">Submit</button>
            <button class="cancel-button" onclick="cancelForm()">Cancel</button>
        </form>
    </div>
    <hr/>
    {% endif %}

    <div class="row g-2">
        {% for n in news %}
        <div class="col-4">
            <div class="p-3">
                <a class="news-card-link" href="{% url 'news_details' news_id=n.id %}">
                    <div class="news-card">
                        {% if n.cover_image %}
                        <img class="news-card-cover" src="{{ n.cover_image.url }}" alt="Cover Image">
                        {% else %}
                        <img src="{% static 'news_covers/placeholder.png' %}" alt="Placeholder Image">
                        {% endif %}
                        <h2 class="title">{{ n.title }}</h2>
                        <p class="sub-title">{{ n.sub_title }}</p>
                        <p class="description">{{ n.description }}</p>

                        <div class="news-card-footer">
                            <span><i class="bi bi-heart"></i> {{ n.likes.count }}</span>
                            {% if user.is_authenticated %}
                            {% if n.likes.count > 0 and n in user.liked_news.all %}
                            <form method="post" action="{% url 'news' %}">
                                {% csrf_token %}
                                <input type="hidden" name="unlike_news" value="{{ n.id }}">
                                <button class="like-btn" type="submit"><i class="bi bi-hand-thumbs-down"></i></button>
                            </form>
                            {% elif n.likes.count == 0 %}
                            <!-- Show like button when count is 0 -->
                            <form method="post" action="{% url 'news' %}">
                                {% csrf_token %}
                                <input type="hidden" name="like_news" value="{{ n.id }}">
                                <button class="like-btn" type="submit"><i class="bi bi-hand-thumbs-up"></i></button>
                            </form>
                            {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </a>
            </div>
        </div>
        {% if forloop.counter|divisibleby:3 and not forloop.last %}
    </div>
    <div class="row g-2">
        {% endif %}
        {% endfor %}
    </div>
</div>

{% endblock content %}

{% block script %}
<script src="{% static 'js/news.js' %}"></script>
{% endblock script %}