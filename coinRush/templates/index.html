{% extends "Base/base.html" %}
{% block title %}Coin-Rush Stocks{% endblock %}
{% block content %}
{% load static %}
{% block extraHead %}
    <link rel="stylesheet" href="{% static 'css/stocks.css' %}">
{% endblock extraHead %}


<div class="container mt-4">
    <div class="d-flex justify-content-end align-items-center mb-3">
        <!-- Toggle button icon with reduced margin -->
        <div class="text-primary " data-toggle="collapse" data-target="#stockCarousel" aria-expanded="false" aria-controls="stockCarousel" id="toggleButton">
            <i class="fas fa-toggle-off"></i>
            Highlights
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <!-- Your existing carousel -->
            <div id="stockCarousel" class="carousel slide collapse" data-ride="carousel" data-interval="1500">
                <div class="carousel-inner">
                    {% for stock in top_stocks %}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <div class="row">
                                <div class="col-md-8">
                                    <h5 class="mb-1"><strong>{{ stock.company_name }}</strong> ({{ stock.symbol }})</h5>
                                    <p class="mb-1">Current Price: ${{ stock.current_price }}</p>
                                    <p class="mb-1">Market Cap: ${{ stock.market_cap }}</p>
                                </div>
                                <div class="col-md-4 text-right">
                                    {% if stock.current_price > 100 %}  <!-- Adjust the threshold as needed -->
                                        <span class="badge badge-success">Higher Price</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <a class="carousel-control-prev" href="#stockCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#stockCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>

        <!-- Add three more carousels here with the same structure as the existing one -->
        <!-- You can copy the existing carousel code and modify it for each additional carousel -->

        <div class="col-md-3">
            <!-- Second carousel -->
            <!-- Add your content for the second carousel here -->
        </div>

        <div class="col-md-3">
            <!-- Third carousel -->
            <!-- Add your content for the third carousel here -->
        </div>

    </div>
</div>

<!-- Include Bootstrap JS, Popper.js, and jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Include Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha384-lY6vUp9BEi3iIdva62I0pbTXJswAfPp7bg5+5lU7I95NXRSFQ6F6gJHSa9PxI1Wi" crossorigin="anonymous">

<script>
    $(document).ready(function () {
        // Toggle button state based on collapse events
        $('#stockCarousel').on('show.bs.collapse', function () {
            $('#toggleButton i').removeClass('fa-toggle-off').addClass('fa-toggle-on');
        });

        $('#stockCarousel').on('hide.bs.collapse', function () {
            $('#toggleButton i').removeClass('fa-toggle-on').addClass('fa-toggle-off');
        });
    });
</script>


<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
<button class="btn btn-primary stock-button" onclick="openPopup()">Stock Filters</button>
</div>
</div>

<div id="filterPopup" class="popup">
        <span class="close" onclick="closePopup()">&times;</span>

        <h2><i class="fas fa-filter"></i> Filter Options</h2>
        <form method="get" action="{% url 'home' %}">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Apply Filters</button>
        </form>
    </div>
<div class="overlay" id="overlay" onclick="closePopup()"></div>


<script>
    function openPopup() {
        document.getElementById('filterPopup').style.display = 'block';
                document.getElementById('overlay').style.display = 'block';

    }

    function closePopup() {
        document.getElementById('filterPopup').style.display = 'none';
                document.getElementById('overlay').style.display = 'none';

    }
</script>

<script>
    function openPopup() {
        document.getElementById('filterPopup').style.display = 'block';
    }

    function closePopup() {
        document.getElementById('filterPopup').style.display = 'none';
    }
</script>

    <div class="row mt-4">
        <div class="col-lg-8">
               <ul id="stock-sort" class="nav nav-pills d-flex justify-content-end mb-2">
    <li class="nav-item">
        <span class="mx-2"><i class="fa fa-sort"></i></span>
    </li>
    <li class="nav-item">
        <a class="nav-link {% if request.GET.order_by == 'max-price' or request.GET.order_by == None  or request.GET.order_by == '' %} active {% else %} inactive {% endif %}" aria-current="page" href="?order_by=max-price">Max Price</a>
    </li>
    <li class="nav-item">
        <a class="nav-link{% if request.GET.order_by == 'min-price' %} active {% else %} inactive {% endif %}" href="?order_by=min-price">Min Price</a>
    </li>
    <li class="nav-item">
        <a class="nav-link{% if request.GET.order_by == 'max-market-cap' %} active {% else %} inactive {% endif %}" href="?order_by=max-market-cap">Max Market Cap</a>
    </li>
    <li class="nav-item">
        <a class="nav-link{% if request.GET.order_by == 'min-market-cap' %} active {% else %} inactive {% endif %}" href="?order_by=min-market-cap">Min Market Cap</a>
    </li>
</ul>
                    </div>
                </div>

    <h1>Stocks</h1>
    {% if stocks %}
        <table class="table table-striped">
            <thead>
            <tr>
                <th>Symbol</th>
                <th>Company Name</th>
                <th>Price</th>
                <th>Market Cap</th>
                <th>Last Updated</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for stock in stocks %}
                <tr>
                    <td><img src="{{ stock.image.url }}" alt="{{ stock.symbol }}" width="30"
                             height="30"><a href="{% url 'stock_chart' stock_id=stock.pk %}" >{{ stock.symbol }}</td>
                    <td>{{ stock.company_name }}</td>
                    <td>${{ stock.current_price }}</td>
                    <td>${{ stock.market_cap }}</td>
                    <td>{{ stock.last_updated }}</td>
                    <td><a href="{% url 'buy_stock' stock.symbol %}" class="btn btn-primary">
                        <i class="bi bi-cart"></i> Buy
                    </a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No stock data available</p>
    {% endif %}
{% endblock %}
